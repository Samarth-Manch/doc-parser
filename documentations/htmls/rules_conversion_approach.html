<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Natural Language to Manch Rules - Conversion Approach</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-card: #ffffff;
            --border: #e2e8f0;
            --text: #1e293b;
            --text-muted: #64748b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-light);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 12px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .section h2 {
            color: var(--primary);
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }

        .section h3 {
            color: var(--text);
            font-size: 1.2rem;
            margin: 20px 0 15px 0;
        }

        .section h4 {
            color: var(--secondary);
            font-size: 1rem;
            margin: 15px 0 10px 0;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--bg-light);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .card-header .icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .icon-blue { background: #dbeafe; color: var(--primary); }
        .icon-green { background: #dcfce7; color: var(--success); }
        .icon-yellow { background: #fef3c7; color: var(--warning); }
        .icon-red { background: #fee2e2; color: var(--danger); }
        .icon-purple { background: #f3e8ff; color: #9333ea; }

        code {
            background: #1e293b;
            color: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        pre .comment { color: #6b7280; }
        pre .keyword { color: #f472b6; }
        pre .string { color: #86efac; }
        pre .function { color: #fbbf24; }
        pre .number { color: #93c5fd; }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid var(--border);
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
            color: var(--text);
        }

        tr:hover {
            background: var(--bg-light);
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-blue { background: #dbeafe; color: var(--primary); }
        .badge-green { background: #dcfce7; color: var(--success); }
        .badge-yellow { background: #fef3c7; color: var(--warning); }
        .badge-red { background: #fee2e2; color: var(--danger); }
        .badge-purple { background: #f3e8ff; color: #9333ea; }

        .flow-diagram {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 30px 20px;
            background: var(--bg-light);
            border-radius: 8px;
            margin: 20px 0;
        }

        .flow-step {
            background: white;
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 15px 20px;
            text-align: center;
            min-width: 150px;
        }

        .flow-step .step-num {
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
        }

        .flow-arrow {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .highlight-box {
            background: linear-gradient(135deg, #dbeafe, #ede9fe);
            border-left: 4px solid var(--primary);
            padding: 20px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }

        .highlight-box h4 {
            margin-top: 0;
            color: var(--primary-dark);
        }

        .cost-table td:nth-child(3),
        .cost-table td:nth-child(4) {
            text-align: right;
        }

        .comparison-row {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-col {
            flex: 1;
        }

        .comparison-col h4 {
            text-align: center;
            padding: 10px;
            border-radius: 8px 8px 0 0;
        }

        .comparison-col.before h4 {
            background: #fee2e2;
            color: var(--danger);
        }

        .comparison-col.after h4 {
            background: #dcfce7;
            color: var(--success);
        }

        ul, ol {
            margin: 10px 0 10px 25px;
        }

        li {
            margin: 8px 0;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .metric-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .architecture-diagram {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
        }

        .arch-layer {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .arch-layer-title {
            background: white;
            padding: 5px 15px;
            margin-top: -35px;
            margin-left: 20px;
            display: inline-block;
            font-weight: 600;
            color: var(--primary);
        }

        .arch-components {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .arch-component {
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px 18px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            header h1 { font-size: 1.8rem; }
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .flow-diagram { flex-direction: column; }
            .flow-arrow { transform: rotate(90deg); }
            .comparison-row { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Natural Language to Manch Rules</h1>
            <p>Efficient & Cost-Effective Conversion Approach</p>
        </header>

        <!-- Executive Summary -->
        <div class="section">
            <h2>üìã Executive Summary</h2>
            <p>This document presents an efficient approach to convert natural language logic/rules from document specifications into Manch Platform JSON rules. The solution combines <strong>pattern-based template matching</strong> for common cases with <strong>LLM-powered conversion</strong> for complex scenarios, optimizing for both accuracy and cost.</p>

            <div class="metric-grid">
                <div class="metric">
                    <div class="metric-value">350+</div>
                    <div class="metric-label">Fields Analyzed</div>
                </div>
                <div class="metric">
                    <div class="metric-value">302</div>
                    <div class="metric-label">Rules to Convert</div>
                </div>
                <div class="metric">
                    <div class="metric-value">100+</div>
                    <div class="metric-label">Rule Actions Available</div>
                </div>
                <div class="metric">
                    <div class="metric-value">~70%</div>
                    <div class="metric-label">Template-Convertible</div>
                </div>
            </div>
        </div>

        <!-- Understanding the Problem -->
        <div class="section">
            <h2>üîç Understanding the Problem</h2>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="icon icon-blue">üìÑ</div>
                        <h3>Source: Natural Language Rules</h3>
                    </div>
                    <p>Rules extracted from document specifications in human-readable format:</p>
                    <pre><span class="comment">// Visibility Rule Example</span>
"Make visible and Mandatory if 'Do you wish to
add additional mobile numbers?' is Yes,
otherwise invisible and non-mandatory"

<span class="comment">// Copy Rule Example</span>
"Copy from 'Basic Details' panel. If GST
uploaded then copy from GST field"

<span class="comment">// Conditional Rule Example</span>
"If Country code is selected then derive
the country name from column 5 of table 1.1"</pre>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="icon icon-green">üéØ</div>
                        <h3>Target: Manch Rule JSON</h3>
                    </div>
                    <p>Structured JSON rules with expression syntax:</p>
                    <pre><span class="comment">// EXECUTE Rule with Expression</span>
{
  "<span class="keyword">action</span>": "<span class="string">EXECUTE</span>",
  "<span class="keyword">expression</span>": "<span class="function">mvi</span>(<span class="function">vo</span>(<span class="number">121</span>)=='<span class="string">Yes</span>',<span class="number">123</span>); \
                <span class="function">mm</span>(<span class="function">vo</span>(<span class="number">121</span>)=='<span class="string">Yes</span>',<span class="number">123</span>)",
  "<span class="keyword">sourceFields</span>": [{"<span class="keyword">id</span>": <span class="number">121</span>}],
  "<span class="keyword">destinationFields</span>": [{"<span class="keyword">id</span>": <span class="number">123</span>}]
}</pre>
                </div>
            </div>

            <h3>Rule Categories Found in Documents</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Count</th>
                            <th>Pattern Keywords</th>
                            <th>Target Manch Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-blue">Visibility</span></td>
                            <td>78</td>
                            <td>"visible", "invisible", "show", "hide"</td>
                            <td>MAKE_VISIBLE, MAKE_INVISIBLE, mvi(), minvi()</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">Mandatory</span></td>
                            <td>28</td>
                            <td>"mandatory", "required", "non-mandatory"</td>
                            <td>MAKE_MANDATORY, MAKE_NON_MANDATORY, mm(), mnm()</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-yellow">Conditional</span></td>
                            <td>38</td>
                            <td>"if...then", "when", "based on"</td>
                            <td>EXECUTE with complex expressions</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-purple">Copy/Derive</span></td>
                            <td>14</td>
                            <td>"copy from", "auto-populate", "derive"</td>
                            <td>COPY_TO, CONDITIONAL_COPY, ctfd()</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-red">Validation</span></td>
                            <td>16</td>
                            <td>"validate", "must be", "should be"</td>
                            <td>VALIDATION, adderr(), remerr()</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">Other</span></td>
                            <td>128</td>
                            <td>Mixed patterns</td>
                            <td>Various (OCR, LOOKUP, etc.)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Proposed Architecture -->
        <div class="section">
            <h2>üèóÔ∏è Proposed Architecture</h2>

            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="step-num">1</div>
                    <strong>Document Parsing</strong>
                    <br><small>Extract fields & logic</small>
                </div>
                <span class="flow-arrow">‚Üí</span>
                <div class="flow-step">
                    <div class="step-num">2</div>
                    <strong>Field ID Assignment</strong>
                    <br><small>Generate form-fill-metadata-ids</small>
                </div>
                <span class="flow-arrow">‚Üí</span>
                <div class="flow-step">
                    <div class="step-num">3</div>
                    <strong>Pattern Classification</strong>
                    <br><small>Categorize rule types</small>
                </div>
                <span class="flow-arrow">‚Üí</span>
                <div class="flow-step">
                    <div class="step-num">4</div>
                    <strong>Rule Generation</strong>
                    <br><small>Template or LLM</small>
                </div>
                <span class="flow-arrow">‚Üí</span>
                <div class="flow-step">
                    <div class="step-num">5</div>
                    <strong>Validation</strong>
                    <br><small>Syntax & logic check</small>
                </div>
            </div>

            <div class="architecture-diagram">
                <div class="arch-layer">
                    <div class="arch-layer-title">Layer 1: Preprocessing</div>
                    <div class="arch-components">
                        <div class="arch-component">üìÑ Document Parser</div>
                        <div class="arch-component">üè∑Ô∏è Field Extractor</div>
                        <div class="arch-component">üìä Reference Table Loader</div>
                        <div class="arch-component">üî¢ ID Generator</div>
                    </div>
                </div>

                <div class="arch-layer">
                    <div class="arch-layer-title">Layer 2: Rule Classification</div>
                    <div class="arch-components">
                        <div class="arch-component">üîç Pattern Matcher</div>
                        <div class="arch-component">üìÇ Rule Categorizer</div>
                        <div class="arch-component">üéØ Complexity Scorer</div>
                        <div class="arch-component">üîó Dependency Resolver</div>
                    </div>
                </div>

                <div class="arch-layer">
                    <div class="arch-layer-title">Layer 3: Conversion Engine</div>
                    <div class="arch-components">
                        <div class="arch-component">üìù Template Engine (~70%)</div>
                        <div class="arch-component">ü§ñ LLM Converter (~30%)</div>
                        <div class="arch-component">üíæ Rule Cache</div>
                        <div class="arch-component">üîÑ Expression Builder</div>
                    </div>
                </div>

                <div class="arch-layer">
                    <div class="arch-layer-title">Layer 4: Validation & Output</div>
                    <div class="arch-components">
                        <div class="arch-component">‚úÖ Syntax Validator</div>
                        <div class="arch-component">üß™ Logic Tester</div>
                        <div class="arch-component">üìã JSON Generator</div>
                        <div class="arch-component">üì§ API Exporter</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hybrid Approach -->
        <div class="section">
            <h2>‚ö° Hybrid Approach: Templates + LLM</h2>

            <div class="highlight-box">
                <h4>Key Insight: 70% of rules follow predictable patterns</h4>
                <p>By using templates for common patterns and reserving LLM calls for complex cases, we can achieve <strong>90%+ accuracy</strong> while reducing costs by <strong>60-70%</strong> compared to pure LLM approaches.</p>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="icon icon-green">üìã</div>
                        <h3>Template-Based (Fast Path)</h3>
                    </div>
                    <p><strong>~70% of rules</strong> - No API cost, instant conversion</p>
                    <h4>Supported Patterns:</h4>
                    <ul>
                        <li><strong>Simple Visibility:</strong> "Make visible/invisible if [field] = [value]"</li>
                        <li><strong>Simple Mandatory:</strong> "Mandatory if [field] = [value]"</li>
                        <li><strong>Direct Copy:</strong> "Copy from [source field]"</li>
                        <li><strong>Dropdown Lookup:</strong> "Values from [table] column [n]"</li>
                        <li><strong>Session-based:</strong> "Visible for [actor type]"</li>
                    </ul>
                    <pre><span class="comment">// Template Example</span>
<span class="keyword">Pattern</span>: "visible if {source} is {value}"
<span class="keyword">Template</span>: <span class="function">mvi</span>(<span class="function">vo</span>({src_id})=='{value}',{dest_id})</pre>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="icon icon-purple">ü§ñ</div>
                        <h3>LLM-Based (Smart Path)</h3>
                    </div>
                    <p><strong>~30% of rules</strong> - API cost, handles complexity</p>
                    <h4>Handles:</h4>
                    <ul>
                        <li><strong>Complex Conditions:</strong> Multiple ANDs, ORs, nested logic</li>
                        <li><strong>Multi-action Rules:</strong> Combined visibility + mandatory + copy</li>
                        <li><strong>Context-dependent:</strong> Rules referencing other rules</li>
                        <li><strong>Ambiguous Language:</strong> Requires interpretation</li>
                        <li><strong>Table Lookups:</strong> Complex column/row references</li>
                    </ul>
                    <pre><span class="comment">// LLM handles complex rules like:</span>
"If GST uploaded then copy from GST field
and make Non-Mandatory, Non-Editable.
If GST not uploaded then mandatory.
If Aadhaar uploaded then get from OCR."</pre>
                </div>
            </div>
        </div>

        <!-- Template Engine -->
        <div class="section">
            <h2>üìù Template Engine Design</h2>

            <h3>Pattern Recognition Rules</h3>
            <pre><span class="comment"># Pattern matching regex and templates</span>

<span class="keyword">PATTERNS</span> = {
    <span class="comment"># Visibility Patterns</span>
    "<span class="string">simple_visible</span>": {
        "regex": r"(?:make\s+)?visible\s+(?:if|when)\s+['\"]?(.+?)['\"]?\s+(?:is|=|==)\s+['\"]?(.+?)['\"]?",
        "action": "MAKE_VISIBLE",
        "expression": "<span class="function">mvi</span>(<span class="function">vo</span>({src_id})=='{value}',{dest_id})"
    },

    "<span class="string">simple_invisible</span>": {
        "regex": r"(?:make\s+)?invisible\s+(?:if|when)\s+['\"]?(.+?)['\"]?\s+(?:is|=|==)\s+['\"]?(.+?)['\"]?",
        "action": "MAKE_INVISIBLE",
        "expression": "<span class="function">minvi</span>(<span class="function">vo</span>({src_id})=='{value}',{dest_id})"
    },

    <span class="comment"># Mandatory Patterns</span>
    "<span class="string">simple_mandatory</span>": {
        "regex": r"mandatory\s+(?:if|when)\s+['\"]?(.+?)['\"]?\s+(?:is|=|==)\s+['\"]?(.+?)['\"]?",
        "action": "MAKE_MANDATORY",
        "expression": "<span class="function">mm</span>(<span class="function">vo</span>({src_id})=='{value}',{dest_id})"
    },

    <span class="comment"># Copy Patterns</span>
    "<span class="string">copy_from</span>": {
        "regex": r"copy\s+(?:from|the\s+value\s+of)\s+['\"]?(.+?)['\"]?(?:\s+field)?",
        "action": "COPY_TO",
        "expression": "<span class="function">ctfd</span>(true,<span class="function">vo</span>({src_id}),{dest_id})"
    },

    <span class="comment"># Conditional Copy</span>
    "<span class="string">conditional_copy</span>": {
        "regex": r"if\s+['\"]?(.+?)['\"]?\s+(?:is|=|==)\s+['\"]?(.+?)['\"]?\s+then\s+copy",
        "action": "CONDITIONAL_COPY",
        "expression": "<span class="function">ctfd</span>(<span class="function">vo</span>({cond_id})=='{cond_val}',<span class="function">vo</span>({src_id}),{dest_id})"
    }
}</pre>

            <h3>Field Resolution Algorithm</h3>
            <pre><span class="keyword">def</span> <span class="function">resolve_field_reference</span>(text, field_map):
    <span class="string">"""
    Resolve natural language field reference to field ID.

    Examples:
    - "Mobile Number field" -> field_map['Mobile Number']
    - "previous field" -> context-dependent resolution
    - "Basic Details panel" -> panel_id
    """</span>

    <span class="comment"># Direct name match</span>
    <span class="keyword">for</span> name, field_id <span class="keyword">in</span> field_map.items():
        <span class="keyword">if</span> name.lower() <span class="keyword">in</span> text.lower():
            <span class="keyword">return</span> field_id

    <span class="comment"># Fuzzy match for variations</span>
    best_match = fuzzy_match(text, field_map.keys())
    <span class="keyword">if</span> best_match.score > <span class="number">0.8</span>:
        <span class="keyword">return</span> field_map[best_match.name]

    <span class="comment"># Return None for LLM fallback</span>
    <span class="keyword">return</span> <span class="keyword">None</span></pre>
        </div>

        <!-- LLM Conversion -->
        <div class="section">
            <h2>ü§ñ LLM Conversion Strategy</h2>

            <h3>Optimized Prompt Design</h3>
            <pre><span class="keyword">SYSTEM_PROMPT</span> = <span class="string">"""
You are a Manch Platform rule converter. Convert natural language rules
to Manch expression syntax.

## Available Functions:
- vo(id) - Get value of field by ID
- mvi(condition, destIds) - Make visible if condition true
- minvi(condition, destIds) - Make invisible if condition true
- mm(condition, destIds) - Make mandatory if condition true
- mnm(condition, destIds) - Make non-mandatory if condition true
- ctfd(condition, srcValue, destIds) - Copy value if condition true
- en(condition, destIds) - Enable fields
- dis(condition, destIds) - Disable fields
- cf(condition, destIds) - Clear fields
- concat(values) - Concatenate values
- cwd(delimiter, values) - Concatenate with delimiter

## Field ID Mapping:
{field_mapping}

## Reference Tables:
{reference_tables}

## Output Format:
Return ONLY the expression string, no explanation.
"""</span>

<span class="keyword">USER_PROMPT</span> = <span class="string">"""
Convert this rule for field "{field_name}" (ID: {field_id}):

Rule: {logic_text}

Source Field(s): {source_fields}
Destination Field(s): {dest_fields}
"""</span></pre>

            <h3>Cost Optimization Strategies</h3>
            <div class="grid-3">
                <div class="card">
                    <h4>1. Batch Processing</h4>
                    <p>Group similar rules together and process in batches of 10-20 to reduce API overhead.</p>
                    <pre><span class="comment"># Batch 20 rules per request</span>
rules_batch = chunk(rules, <span class="number">20</span>)
results = llm.batch(rules_batch)</pre>
                </div>

                <div class="card">
                    <h4>2. Response Caching</h4>
                    <p>Cache LLM responses for identical or similar rule patterns to avoid redundant calls.</p>
                    <pre><span class="comment"># Hash rule text for cache key</span>
cache_key = hash(normalize(rule))
<span class="keyword">if</span> cache_key <span class="keyword">in</span> cache:
    <span class="keyword">return</span> cache[cache_key]</pre>
                </div>

                <div class="card">
                    <h4>3. Model Selection</h4>
                    <p>Use Haiku for simple rules, Sonnet for complex ones to optimize cost.</p>
                    <pre><span class="comment"># Route by complexity</span>
<span class="keyword">if</span> complexity < <span class="number">0.5</span>:
    model = "haiku"
<span class="keyword">else</span>:
    model = "sonnet"</pre>
                </div>
            </div>
        </div>

        <!-- Cost Analysis -->
        <div class="section">
            <h2>üí∞ Cost Analysis</h2>

            <h3>Estimated Costs per Document (~300 rules)</h3>
            <div class="table-container">
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>Approach</th>
                            <th>Description</th>
                            <th>API Calls</th>
                            <th>Est. Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-red">Pure LLM</span></td>
                            <td>Every rule via Claude Sonnet</td>
                            <td>300</td>
                            <td>$3.00 - $6.00</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-yellow">LLM + Caching</span></td>
                            <td>With response caching</td>
                            <td>~150</td>
                            <td>$1.50 - $3.00</td>
                        </tr>
                        <tr style="background: #dcfce7;">
                            <td><span class="badge badge-green">Hybrid (Recommended)</span></td>
                            <td>Templates + LLM for complex</td>
                            <td>~90</td>
                            <td>$0.50 - $1.00</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">Hybrid + Haiku</span></td>
                            <td>Use Haiku for medium complexity</td>
                            <td>~90</td>
                            <td>$0.15 - $0.30</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="highlight-box">
                <h4>üí° Recommended: Hybrid + Haiku Approach</h4>
                <ul>
                    <li><strong>70% Template-based:</strong> Zero API cost, instant results</li>
                    <li><strong>20% Haiku (medium complexity):</strong> ~$0.00025/1K tokens</li>
                    <li><strong>10% Sonnet (high complexity):</strong> ~$0.003/1K tokens</li>
                </ul>
                <p><strong>Total estimated cost per document: $0.15 - $0.30</strong></p>
            </div>
        </div>

        <!-- Conversion Examples -->
        <div class="section">
            <h2>üîÑ Conversion Examples</h2>

            <h3>Example 1: Simple Visibility Rule</h3>
            <div class="comparison-row">
                <div class="comparison-col before">
                    <h4>Natural Language</h4>
                    <pre>"Make visible and Mandatory if
'Do you wish to add additional
mobile numbers?' is Yes, otherwise
invisible and non-mandatory"</pre>
                </div>
                <div class="comparison-col after">
                    <h4>Manch Expression</h4>
                    <pre><span class="function">mvi</span>(<span class="function">vo</span>(<span class="number">121</span>)=='<span class="string">Yes</span>',<span class="number">122</span>);
<span class="function">mm</span>(<span class="function">vo</span>(<span class="number">121</span>)=='<span class="string">Yes</span>',<span class="number">122</span>);
<span class="function">minvi</span>(<span class="function">vo</span>(<span class="number">121</span>)!='<span class="string">Yes</span>',<span class="number">122</span>);
<span class="function">mnm</span>(<span class="function">vo</span>(<span class="number">121</span>)!='<span class="string">Yes</span>',<span class="number">122</span>)</pre>
                </div>
            </div>

            <h3>Example 2: Conditional Copy with Multiple Sources</h3>
            <div class="comparison-row">
                <div class="comparison-col before">
                    <h4>Natural Language</h4>
                    <pre>"If GST uploaded then copy from
GST field and Non-Mandatory.
If GST not uploaded then mandatory.
If Aadhaar uploaded then get from
Aadhaar OCR."</pre>
                </div>
                <div class="comparison-col after">
                    <h4>Manch Expression</h4>
                    <pre><span class="function">ctfd</span>(<span class="function">vo</span>(<span class="number">101</span>)!=''<span class="keyword">and</span><span class="function">vo</span>(<span class="number">101</span>)!=<span class="keyword">null</span>,
     <span class="function">vo</span>(<span class="number">102</span>),<span class="number">150</span>);
<span class="function">mnm</span>(<span class="function">vo</span>(<span class="number">101</span>)!=''<span class="keyword">and</span><span class="function">vo</span>(<span class="number">101</span>)!=<span class="keyword">null</span>,<span class="number">150</span>);
<span class="function">dis</span>(<span class="function">vo</span>(<span class="number">101</span>)!=''<span class="keyword">and</span><span class="function">vo</span>(<span class="number">101</span>)!=<span class="keyword">null</span>,<span class="number">150</span>);
<span class="function">mm</span>(<span class="function">vo</span>(<span class="number">101</span>)==''<span class="keyword">or</span><span class="function">vo</span>(<span class="number">101</span>)==<span class="keyword">null</span>,<span class="number">150</span>);
<span class="function">ctfd</span>(<span class="function">vo</span>(<span class="number">103</span>)!=''<span class="keyword">and</span><span class="function">vo</span>(<span class="number">103</span>)!=<span class="keyword">null</span>,
     <span class="function">vo</span>(<span class="number">104</span>),<span class="number">150</span>)</pre>
                </div>
            </div>

            <h3>Example 3: Dropdown from Reference Table</h3>
            <div class="comparison-row">
                <div class="comparison-col before">
                    <h4>Natural Language</h4>
                    <pre>"Dropdown values will come from
column 3 based on process type
filter (DOM IN or INT) as column 1
of reference table 1.2"</pre>
                </div>
                <div class="comparison-col after">
                    <h4>Manch Rule JSON</h4>
                    <pre>{
  "<span class="keyword">action</span>": "<span class="string">EXT_DROP_DOWN</span>",
  "<span class="keyword">source</span>": "<span class="string">LOOKUP_TABLE</span>",
  "<span class="keyword">params</span>": {
    "<span class="keyword">tableId</span>": "<span class="string">ref_table_1_2</span>",
    "<span class="keyword">filterColumn</span>": <span class="number">1</span>,
    "<span class="keyword">filterValue</span>": "<span class="function">vo</span>(<span class="number">105</span>)",
    "<span class="keyword">valueColumn</span>": <span class="number">3</span>
  }
}</pre>
                </div>
            </div>
        </div>

        <!-- Implementation Plan -->
        <div class="section">
            <h2>üìÖ Implementation Plan</h2>

            <h3>Phase 1: Foundation (Week 1-2)</h3>
            <ul>
                <li>‚úÖ Enhance document parser to extract all logic/rules</li>
                <li>‚úÖ Build field ID assignment system (form-fill-metadata-id generation)</li>
                <li>‚¨ú Create pattern classification module</li>
                <li>‚¨ú Build template engine with 20+ common patterns</li>
            </ul>

            <h3>Phase 2: Core Engine (Week 3-4)</h3>
            <ul>
                <li>‚¨ú Implement LLM conversion module with optimized prompts</li>
                <li>‚¨ú Build caching layer for rule responses</li>
                <li>‚¨ú Create expression syntax validator</li>
                <li>‚¨ú Implement reference table resolver</li>
            </ul>

            <h3>Phase 3: Integration (Week 5-6)</h3>
            <ul>
                <li>‚¨ú Integrate with Manch API for rule creation</li>
                <li>‚¨ú Build GUI for rule review and editing</li>
                <li>‚¨ú Add batch processing capability</li>
                <li>‚¨ú Implement error handling and recovery</li>
            </ul>

            <h3>Phase 4: Optimization (Week 7-8)</h3>
            <ul>
                <li>‚¨ú Fine-tune template patterns based on real usage</li>
                <li>‚¨ú Optimize LLM prompts for better accuracy</li>
                <li>‚¨ú Add rule testing and simulation</li>
                <li>‚¨ú Documentation and training</li>
            </ul>
        </div>

        <!-- Technical Specifications -->
        <div class="section">
            <h2>‚öôÔ∏è Technical Specifications</h2>

            <div class="grid-2">
                <div class="card">
                    <h3>Input Requirements</h3>
                    <ul>
                        <li><strong>Document Format:</strong> OOXML (.docx)</li>
                        <li><strong>Field Tables:</strong> Must contain field name, type, logic columns</li>
                        <li><strong>Reference Tables:</strong> Excel embedded or in-document tables</li>
                        <li><strong>Naming Convention:</strong> Consistent field naming across documents</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>Output Format</h3>
                    <ul>
                        <li><strong>Rule JSON:</strong> Manch-compatible rule schemas</li>
                        <li><strong>Field Mapping:</strong> Name-to-ID mapping file</li>
                        <li><strong>Validation Report:</strong> Conversion success/failure log</li>
                        <li><strong>API Payload:</strong> Ready-to-send Manch API requests</li>
                    </ul>
                </div>
            </div>

            <h3>Required Dependencies</h3>
            <pre><span class="comment"># requirements.txt additions</span>
anthropic>=0.18.0      <span class="comment"># Claude API client</span>
python-dotenv>=1.0.0   <span class="comment"># Environment variables</span>
rapidfuzz>=3.0.0       <span class="comment"># Fuzzy string matching</span>
jsonschema>=4.0.0      <span class="comment"># Rule schema validation</span>
cachetools>=5.0.0      <span class="comment"># Response caching</span></pre>
        </div>

        <!-- Risk Mitigation -->
        <div class="section">
            <h2>‚ö†Ô∏è Risk Mitigation</h2>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Risk</th>
                            <th>Impact</th>
                            <th>Mitigation Strategy</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ambiguous field references</td>
                            <td><span class="badge badge-yellow">Medium</span></td>
                            <td>Fuzzy matching + manual review queue for low-confidence matches</td>
                        </tr>
                        <tr>
                            <td>Complex nested conditions</td>
                            <td><span class="badge badge-yellow">Medium</span></td>
                            <td>LLM fallback with specialized prompts for complex logic</td>
                        </tr>
                        <tr>
                            <td>Invalid expression syntax</td>
                            <td><span class="badge badge-red">High</span></td>
                            <td>Syntax validator + expression parser before API submission</td>
                        </tr>
                        <tr>
                            <td>Missing reference tables</td>
                            <td><span class="badge badge-yellow">Medium</span></td>
                            <td>Pre-validation check + warning system for undefined references</td>
                        </tr>
                        <tr>
                            <td>LLM hallucination</td>
                            <td><span class="badge badge-red">High</span></td>
                            <td>Constrained output format + function whitelist + validation layer</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Conclusion -->
        <div class="section">
            <h2>‚úÖ Conclusion & Recommendation</h2>

            <div class="highlight-box">
                <h4>Recommended Approach: Hybrid Template + LLM System</h4>
                <p>Based on the analysis of 302 rules across document specifications, I recommend implementing a <strong>hybrid system</strong> that:</p>
                <ol>
                    <li><strong>Uses templates for ~70% of rules</strong> - Fast, free, predictable</li>
                    <li><strong>Uses Claude Haiku for ~20% medium complexity</strong> - Cost-effective AI</li>
                    <li><strong>Uses Claude Sonnet for ~10% complex rules</strong> - Maximum accuracy</li>
                    <li><strong>Includes validation layer</strong> - Catch errors before API submission</li>
                    <li><strong>Implements caching</strong> - Reduce redundant API calls</li>
                </ol>
            </div>

            <div class="metric-grid">
                <div class="metric">
                    <div class="metric-value">~95%</div>
                    <div class="metric-label">Expected Accuracy</div>
                </div>
                <div class="metric">
                    <div class="metric-value">$0.20</div>
                    <div class="metric-label">Avg. Cost per Document</div>
                </div>
                <div class="metric">
                    <div class="metric-value">~2 min</div>
                    <div class="metric-label">Processing Time</div>
                </div>
                <div class="metric">
                    <div class="metric-value">70%</div>
                    <div class="metric-label">Cost Savings vs Pure LLM</div>
                </div>
            </div>

            <p style="margin-top: 20px; text-align: center; color: var(--text-muted);">
                <strong>Next Steps:</strong> Approve approach ‚Üí Start Phase 1 implementation ‚Üí Validate with sample documents
            </p>
        </div>

        <footer style="text-align: center; padding: 30px; color: var(--text-muted);">
            <p>Generated by Document Parser Analysis Tool</p>
            <p>Date: January 2026</p>
        </footer>
    </div>
</body>
</html>
