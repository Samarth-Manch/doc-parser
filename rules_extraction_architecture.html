<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rules Extraction Architecture - Document Parser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .section h2 {
            color: #00d4ff;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, #00d4ff, #7c3aed);
            border-radius: 2px;
        }

        /* Architecture Flow */
        .architecture-flow {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .flow-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .flow-box {
            background: linear-gradient(145deg, rgba(0,212,255,0.1), rgba(124,58,237,0.1));
            border: 2px solid rgba(0,212,255,0.3);
            border-radius: 12px;
            padding: 20px;
            min-width: 200px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
        }

        .flow-box:hover {
            transform: translateY(-5px);
            border-color: #00d4ff;
            box-shadow: 0 10px 40px rgba(0,212,255,0.2);
        }

        .flow-box.input {
            background: linear-gradient(145deg, rgba(34,197,94,0.2), rgba(34,197,94,0.05));
            border-color: rgba(34,197,94,0.5);
        }

        .flow-box.llm {
            background: linear-gradient(145deg, rgba(251,146,60,0.2), rgba(251,146,60,0.05));
            border-color: rgba(251,146,60,0.5);
        }

        .flow-box.output {
            background: linear-gradient(145deg, rgba(168,85,247,0.2), rgba(168,85,247,0.05));
            border-color: rgba(168,85,247,0.5);
        }

        .flow-box.cache {
            background: linear-gradient(145deg, rgba(59,130,246,0.2), rgba(59,130,246,0.05));
            border-color: rgba(59,130,246,0.5);
        }

        .flow-box h3 {
            font-size: 1em;
            margin-bottom: 8px;
        }

        .flow-box p {
            font-size: 0.85em;
            color: #aaa;
        }

        .flow-box .badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #7c3aed;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: bold;
        }

        .flow-box .badge.no-llm {
            background: #22c55e;
        }

        .flow-box .badge.light-llm {
            background: #f59e0b;
        }

        .arrow {
            font-size: 2em;
            color: #00d4ff;
        }

        .arrow-down {
            text-align: center;
            font-size: 2em;
            color: #00d4ff;
        }

        /* Pipeline */
        .pipeline {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pipeline-stage {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 25px;
            border-left: 4px solid #00d4ff;
        }

        .pipeline-stage.stage-1 { border-left-color: #22c55e; }
        .pipeline-stage.stage-2 { border-left-color: #3b82f6; }
        .pipeline-stage.stage-3 { border-left-color: #f59e0b; }
        .pipeline-stage.stage-4 { border-left-color: #ef4444; }
        .pipeline-stage.stage-5 { border-left-color: #a855f7; }

        .pipeline-stage h3 {
            font-size: 1.1em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stage-number {
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .pipeline-stage ul {
            list-style: none;
            padding-left: 0;
        }

        .pipeline-stage li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.9em;
            color: #ccc;
        }

        .pipeline-stage li:last-child {
            border-bottom: none;
        }

        .pipeline-stage li::before {
            content: '‚Üí';
            margin-right: 10px;
            color: #00d4ff;
        }

        /* Rule Types */
        .rule-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        .rule-type-card {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .rule-type-card h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .rule-type-card.expression h3 {
            color: #f59e0b;
        }

        .rule-type-card.standard h3 {
            color: #22c55e;
        }

        .code-block {
            background: #0d1117;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85em;
            overflow-x: auto;
            margin: 10px 0;
        }

        .code-block .keyword { color: #ff7b72; }
        .code-block .function { color: #d2a8ff; }
        .code-block .string { color: #a5d6ff; }
        .code-block .variable { color: #ffa657; }
        .code-block .comment { color: #8b949e; }

        /* Cost Analysis */
        .cost-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .cost-table th, .cost-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .cost-table th {
            background: rgba(0,212,255,0.1);
            color: #00d4ff;
            font-weight: 600;
        }

        .cost-table tr:hover {
            background: rgba(255,255,255,0.02);
        }

        .cost-low { color: #22c55e; }
        .cost-medium { color: #f59e0b; }
        .cost-high { color: #ef4444; }

        /* Strategies */
        .strategies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .strategy-card {
            background: linear-gradient(145deg, rgba(0,0,0,0.4), rgba(0,0,0,0.2));
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .strategy-card h4 {
            color: #7c3aed;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .strategy-card p {
            color: #aaa;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .icon {
            font-size: 1.2em;
        }

        /* Data Flow Diagram */
        .data-flow {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
        }

        .data-flow-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .data-node {
            background: linear-gradient(145deg, rgba(0,212,255,0.15), rgba(124,58,237,0.1));
            border: 1px solid rgba(0,212,255,0.3);
            border-radius: 10px;
            padding: 15px 25px;
            text-align: center;
            min-width: 150px;
        }

        .data-node.document { border-color: #22c55e; }
        .data-node.process { border-color: #3b82f6; }
        .data-node.llm-node { border-color: #f59e0b; }
        .data-node.output-node { border-color: #a855f7; }

        .data-node h4 {
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .data-node p {
            font-size: 0.75em;
            color: #888;
        }

        .flow-connector {
            flex: 1;
            height: 2px;
            background: linear-gradient(90deg, rgba(0,212,255,0.5), rgba(124,58,237,0.5));
            position: relative;
            min-width: 30px;
        }

        .flow-connector::after {
            content: '‚ñ∂';
            position: absolute;
            right: -5px;
            top: -8px;
            color: #7c3aed;
            font-size: 0.8em;
        }

        /* Functions Reference */
        .functions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .function-item {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
        }

        .function-item code {
            color: #d2a8ff;
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
        }

        .function-item p {
            color: #888;
            font-size: 0.8em;
            margin-top: 8px;
        }

        /* Summary Stats */
        .stats-row {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
        }

        .stat-number {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #888;
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .flow-row { flex-direction: column; }
            .arrow { transform: rotate(90deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Rules Extraction Architecture</h1>
        <p class="subtitle">Efficient & Cost-Effective Natural Language to Expression Rules Conversion</p>

        <!-- Summary Stats -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-number">2</div>
                <div class="stat-label">Rule Types</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">17</div>
                <div class="stat-label">Rule Clusters</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">182</div>
                <div class="stat-label">Predefined Rules</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">~70%</div>
                <div class="stat-label">Cost Reduction</div>
            </div>
        </div>

        <!-- High-Level Architecture -->
        <div class="section">
            <h2>High-Level Architecture Flow</h2>

            <div class="architecture-flow">
                <div class="flow-row">
                    <div class="flow-box input">
                        <h3>Word Document</h3>
                        <p>BUD Templates (.docx)</p>
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box">
                        <span class="badge no-llm">No LLM</span>
                        <h3>Document Parser</h3>
                        <p>Extract fields, logic, tables</p>
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box">
                        <span class="badge no-llm">No LLM</span>
                        <h3>Field Registry</h3>
                        <p>Name ‚Üí Variable mapping</p>
                    </div>
                </div>

                <div class="arrow-down">‚Üì</div>

                <div class="flow-row">
                    <div class="flow-box">
                        <span class="badge no-llm">No LLM</span>
                        <h3>Rule Classifier</h3>
                        <p>Pattern-based classification</p>
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box" style="display: flex; gap: 20px; min-width: 350px;">
                        <div style="flex: 1;">
                            <h3 style="color: #f59e0b;">Expression Rules</h3>
                            <p>Visibility, Mandatory, Copy</p>
                        </div>
                        <div style="width: 1px; background: rgba(255,255,255,0.2);"></div>
                        <div style="flex: 1;">
                            <h3 style="color: #22c55e;">Standard Rules</h3>
                            <p>OCR, Validation</p>
                        </div>
                    </div>
                </div>

                <div class="arrow-down">‚Üì</div>

                <div class="flow-row">
                    <div class="flow-box cache">
                        <span class="badge no-llm">No LLM</span>
                        <h3>Pattern Cache</h3>
                        <p>Template matching</p>
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box llm">
                        <span class="badge light-llm">GPT-4o-mini</span>
                        <h3>Intent Extractor</h3>
                        <p>Grounded LLM extraction</p>
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box">
                        <span class="badge no-llm">No LLM</span>
                        <h3>Resolver</h3>
                        <p>Variable name resolution</p>
                    </div>
                </div>

                <div class="arrow-down">‚Üì</div>

                <div class="flow-row">
                    <div class="flow-box">
                        <span class="badge no-llm">No LLM</span>
                        <h3>Validator</h3>
                        <p>Syntax & function check</p>
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box">
                        <span class="badge no-llm">No LLM</span>
                        <h3>Assembler</h3>
                        <p>Build expr-eval syntax</p>
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box output">
                        <h3>Rules JSON</h3>
                        <p>Final output</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Two Rule Types -->
        <div class="section">
            <h2>Two Types of Rules</h2>

            <div class="rule-types">
                <div class="rule-type-card expression">
                    <h3>1. Expression Rules (EXECUTE Action)</h3>
                    <p>Dynamic field behavior using expr-eval JavaScript library</p>

                    <div class="code-block">
                        <span class="comment">// Natural Language Input:</span><br>
                        "If GST option is Yes then make GSTIN field visible and mandatory"<br><br>

                        <span class="comment">// Generated Expression:</span><br>
                        <span class="function">mvi</span>(<span class="function">vo</span>(<span class="string">"__gst_option__"</span>)==<span class="string">'Yes'</span>, <span class="string">"__gstin__"</span>);<br>
                        <span class="function">mm</span>(<span class="function">vo</span>(<span class="string">"__gst_option__"</span>)==<span class="string">'Yes'</span>, <span class="string">"__gstin__"</span>);
                    </div>

                    <h4 style="color: #aaa; margin-top: 15px;">Available Functions:</h4>
                    <div class="functions-grid">
                        <div class="function-item">
                            <code>mvi(condition, ...destIds)</code>
                            <p>Make fields visible</p>
                        </div>
                        <div class="function-item">
                            <code>minvi(condition, ...destIds)</code>
                            <p>Make fields invisible</p>
                        </div>
                        <div class="function-item">
                            <code>mm(condition, ...destIds)</code>
                            <p>Make fields mandatory</p>
                        </div>
                        <div class="function-item">
                            <code>mnm(condition, ...destIds)</code>
                            <p>Make fields non-mandatory</p>
                        </div>
                        <div class="function-item">
                            <code>en(condition, ...destIds)</code>
                            <p>Enable fields (editable)</p>
                        </div>
                        <div class="function-item">
                            <code>dis(condition, ...destIds)</code>
                            <p>Disable fields (read-only)</p>
                        </div>
                        <div class="function-item">
                            <code>ctfd(cond, src, ...dest)</code>
                            <p>Copy value to fields</p>
                        </div>
                        <div class="function-item">
                            <code>cf(condition, ...destIds)</code>
                            <p>Clear field values</p>
                        </div>
                    </div>
                </div>

                <div class="rule-type-card standard">
                    <h3>2. Standard/Predefined Rules</h3>
                    <p>Pre-configured rules from Rule-Schemas.json (182 rules)</p>

                    <div class="code-block">
                        <span class="comment">// Natural Language Input:</span><br>
                        "Apply PAN OCR validation on PAN Card image"<br><br>

                        <span class="comment">// Matched Rule from Schema:</span><br>
                        {<br>
                        &nbsp;&nbsp;<span class="string">"name"</span>: <span class="string">"PAN Card OCR"</span>,<br>
                        &nbsp;&nbsp;<span class="string">"action"</span>: <span class="string">"OCR"</span>,<br>
                        &nbsp;&nbsp;<span class="string">"source"</span>: <span class="string">"PAN_IMAGE"</span>,<br>
                        &nbsp;&nbsp;<span class="string">"destinationFields"</span>: [<span class="string">"panNumber"</span>, <span class="string">"name"</span>]<br>
                        }
                    </div>

                    <h4 style="color: #aaa; margin-top: 15px;">Rule Clusters (17 total, 182 rules):</h4>
                    <div class="functions-grid">
                        <div class="function-item">
                            <code>VERIFY (23)</code>
                            <p>PAN, GST, Bank, ID verification APIs</p>
                        </div>
                        <div class="function-item">
                            <code>COPY_TO (20)</code>
                            <p>Copy to party fields and entities</p>
                        </div>
                        <div class="function-item">
                            <code>OCR (19)</code>
                            <p>PAN, Aadhaar, GST, Passport extraction</p>
                        </div>
                        <div class="function-item">
                            <code>COPY_TO_ATTR (16)</code>
                            <p>Copy to transaction attributes</p>
                        </div>
                        <div class="function-item">
                            <code>FIELD_STATE (12)</code>
                            <p>Visibility, mandatory, enable/disable</p>
                        </div>
                        <div class="function-item">
                            <code>VALIDATION (11)</code>
                            <p>Data validation and comparison</p>
                        </div>
                        <div class="function-item">
                            <code>DATE_TIME (10)</code>
                            <p>Date operations and calculations</p>
                        </div>
                        <div class="function-item">
                            <code>+ 10 more clusters</code>
                            <p>Document, Location, OTP, Identity...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5-Stage Pipeline -->
        <div class="section">
            <h2>5-Stage Processing Pipeline</h2>

            <div class="pipeline">
                <div class="pipeline-stage stage-1">
                    <h3><span class="stage-number">1</span> Pre-Processing</h3>
                    <ul>
                        <li>Parse document with DocumentParser</li>
                        <li>Extract all fields with logic/rules text</li>
                        <li>Build field registry (displayName ‚Üí variableName)</li>
                        <li>Generate variable names if missing</li>
                        <li><strong>Cost: $0 (No LLM)</strong></li>
                    </ul>
                </div>

                <div class="pipeline-stage stage-2">
                    <h3><span class="stage-number">2</span> Classification</h3>
                    <ul>
                        <li>Pattern-based rule type detection</li>
                        <li>Keywords: visible/mandatory ‚Üí Expression</li>
                        <li>Keywords: OCR/validation ‚Üí Standard</li>
                        <li>Check for conditional logic (if/when/based on)</li>
                        <li><strong>Cost: $0 (Pattern Matching)</strong></li>
                    </ul>
                </div>

                <div class="pipeline-stage stage-3">
                    <h3><span class="stage-number">3</span> Intent Extraction</h3>
                    <ul>
                        <li>Check pattern cache for similar rules</li>
                        <li>If cached ‚Üí use template (No LLM)</li>
                        <li>If new ‚Üí call GPT-4o-mini with grounded prompt</li>
                        <li>Extract structured intent (display names only)</li>
                        <li><strong>Cost: ~$0.0001/rule (Optimized)</strong></li>
                    </ul>
                </div>

                <div class="pipeline-stage stage-4">
                    <h3><span class="stage-number">4</span> Resolution</h3>
                    <ul>
                        <li>Resolve display names ‚Üí variable names</li>
                        <li>Validate against field registry</li>
                        <li>Match standard rules from Rule-Schemas.json</li>
                        <li>Handle fuzzy matching for field names</li>
                        <li><strong>Cost: $0 (No LLM)</strong></li>
                    </ul>
                </div>

                <div class="pipeline-stage stage-5">
                    <h3><span class="stage-number">5</span> Assembly & Validation</h3>
                    <ul>
                        <li>Validate function names against whitelist</li>
                        <li>Build expr-eval compliant expression</li>
                        <li>Validate syntax correctness</li>
                        <li>Generate final JSON output</li>
                        <li><strong>Cost: $0 (No LLM)</strong></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Anti-Hallucination Strategies -->
        <div class="section">
            <h2>Anti-Hallucination Strategies</h2>

            <div class="strategies-grid">
                <div class="strategy-card">
                    <h4><span class="icon">üéØ</span> Grounded Field Registry</h4>
                    <p>LLM receives ONLY actual field names from the document. System prompt includes complete list of available fields, preventing invention of non-existent fields.</p>
                </div>

                <div class="strategy-card">
                    <h4><span class="icon">üîí</span> Function Whitelist</h4>
                    <p>Only allowed functions (mvi, mm, dis, etc.) are accepted. Any unrecognized function triggers validation error, not silent acceptance.</p>
                </div>

                <div class="strategy-card">
                    <h4><span class="icon">üìù</span> Intent-Only Extraction</h4>
                    <p>LLM extracts ONLY structured intent (function, condition, args) using display names. Variable name resolution happens deterministically post-LLM.</p>
                </div>

                <div class="strategy-card">
                    <h4><span class="icon">‚úÖ</span> Post-LLM Validation</h4>
                    <p>Every field reference is validated against the registry. Unknown fields are flagged for human review rather than silently included.</p>
                </div>

                <div class="strategy-card">
                    <h4><span class="icon">üå°Ô∏è</span> Low Temperature (0.0-0.1)</h4>
                    <p>LLM temperature set to minimum for deterministic outputs. Reduces creative/hallucinatory responses in favor of strict rule following.</p>
                </div>

                <div class="strategy-card">
                    <h4><span class="icon">üìã</span> Structured JSON Output</h4>
                    <p>Force JSON response format with strict schema. Easier to validate and detect anomalies compared to free-form text.</p>
                </div>
            </div>
        </div>

        <!-- Cost Optimization -->
        <div class="section">
            <h2>Cost Optimization Strategies</h2>

            <table class="cost-table">
                <thead>
                    <tr>
                        <th>Strategy</th>
                        <th>Description</th>
                        <th>Savings</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Pattern Caching</strong></td>
                        <td>Cache common rule patterns (e.g., "visible if X is Yes"). Re-use without LLM call.</td>
                        <td class="cost-low">~40% reduction</td>
                    </tr>
                    <tr>
                        <td><strong>Template Matching</strong></td>
                        <td>Pre-define templates for common patterns. Only variable parts need extraction.</td>
                        <td class="cost-low">~30% reduction</td>
                    </tr>
                    <tr>
                        <td><strong>Batch Processing</strong></td>
                        <td>Group similar rules into single LLM call. Reduces API overhead.</td>
                        <td class="cost-medium">~20% reduction</td>
                    </tr>
                    <tr>
                        <td><strong>GPT-4o-mini Model</strong></td>
                        <td>Use smaller model for classification and simple extraction. ~15x cheaper than GPT-4.</td>
                        <td class="cost-low">~90% per call</td>
                    </tr>
                    <tr>
                        <td><strong>Regex Pre-filtering</strong></td>
                        <td>Skip LLM for empty logic or simple disable-only rules. Handle with regex.</td>
                        <td class="cost-low">~15% reduction</td>
                    </tr>
                </tbody>
            </table>

            <div class="data-flow" style="margin-top: 30px;">
                <h3 style="color: #00d4ff; margin-bottom: 20px;">Cost Comparison (388 fields document)</h3>
                <div class="data-flow-row">
                    <div class="data-node" style="background: rgba(239,68,68,0.2); border-color: #ef4444;">
                        <h4>Naive Approach</h4>
                        <p>LLM for every field</p>
                        <p style="color: #ef4444; font-size: 1.2em; margin-top: 10px;">~$0.50</p>
                    </div>
                    <div class="flow-connector"></div>
                    <div class="data-node" style="background: rgba(34,197,94,0.2); border-color: #22c55e;">
                        <h4>Optimized Approach</h4>
                        <p>Pattern cache + batch + mini</p>
                        <p style="color: #22c55e; font-size: 1.2em; margin-top: 10px;">~$0.10</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Flow Example -->
        <div class="section">
            <h2>Data Transformation Example</h2>

            <div class="data-flow">
                <h3 style="color: #888; margin-bottom: 15px;">Input (Natural Language Logic)</h3>
                <div class="code-block">
"Make visible and Mandatory if \"Do you wish to add additional mobile numbers (India)?\" is Yes
otherwise it should be invisible and non-mandatory."
                </div>

                <div class="arrow-down" style="margin: 20px 0;">‚Üì</div>

                <h3 style="color: #888; margin-bottom: 15px;">Stage 2: Classification Result</h3>
                <div class="code-block">
{
  <span class="string">"rule_type"</span>: <span class="string">"EXPRESSION"</span>,
  <span class="string">"detected_actions"</span>: [<span class="string">"visibility"</span>, <span class="string">"mandatory"</span>],
  <span class="string">"has_condition"</span>: <span class="keyword">true</span>
}
                </div>

                <div class="arrow-down" style="margin: 20px 0;">‚Üì</div>

                <h3 style="color: #888; margin-bottom: 15px;">Stage 3: LLM Intent Extraction (Grounded)</h3>
                <div class="code-block">
{
  <span class="string">"statements"</span>: [
    {
      <span class="string">"function"</span>: <span class="string">"mvi"</span>,
      <span class="string">"condition"</span>: <span class="string">"vo(\"do you wish to add additional mobile numbers (india)?\") == 'Yes'"</span>,
      <span class="string">"args"</span>: [<span class="string">"additional mobile number 1"</span>]  <span class="comment">// Display names, not variable names</span>
    },
    {
      <span class="string">"function"</span>: <span class="string">"mm"</span>,
      <span class="string">"condition"</span>: <span class="string">"vo(\"do you wish to add additional mobile numbers (india)?\") == 'Yes'"</span>,
      <span class="string">"args"</span>: [<span class="string">"additional mobile number 1"</span>]
    },
    {
      <span class="string">"function"</span>: <span class="string">"minvi"</span>,
      <span class="string">"condition"</span>: <span class="string">"vo(\"do you wish to add additional mobile numbers (india)?\") != 'Yes'"</span>,
      <span class="string">"args"</span>: [<span class="string">"additional mobile number 1"</span>]
    },
    {
      <span class="string">"function"</span>: <span class="string">"mnm"</span>,
      <span class="string">"condition"</span>: <span class="string">"vo(\"do you wish to add additional mobile numbers (india)?\") != 'Yes'"</span>,
      <span class="string">"args"</span>: [<span class="string">"additional mobile number 1"</span>]
    }
  ]
}
                </div>

                <div class="arrow-down" style="margin: 20px 0;">‚Üì</div>

                <h3 style="color: #888; margin-bottom: 15px;">Stage 4: Resolution (Display Name ‚Üí Variable Name)</h3>
                <div class="code-block">
<span class="comment">// Field Registry Lookup:</span>
<span class="string">"do you wish to add additional mobile numbers (india)?"</span> ‚Üí <span class="variable">"__add_mobile_india__"</span>
<span class="string">"additional mobile number 1"</span> ‚Üí <span class="variable">"__add_mobile_1__"</span>
                </div>

                <div class="arrow-down" style="margin: 20px 0;">‚Üì</div>

                <h3 style="color: #888; margin-bottom: 15px;">Stage 5: Final Output (expr-eval Expression)</h3>
                <div class="code-block">
<span class="function">mvi</span>(<span class="function">vo</span>(<span class="string">"__add_mobile_india__"</span>)==<span class="string">'Yes'</span>,<span class="string">"__add_mobile_1__"</span>);
<span class="function">mm</span>(<span class="function">vo</span>(<span class="string">"__add_mobile_india__"</span>)==<span class="string">'Yes'</span>,<span class="string">"__add_mobile_1__"</span>);
<span class="function">minvi</span>(<span class="function">vo</span>(<span class="string">"__add_mobile_india__"</span>)!=<span class="string">'Yes'</span>,<span class="string">"__add_mobile_1__"</span>);
<span class="function">mnm</span>(<span class="function">vo</span>(<span class="string">"__add_mobile_india__"</span>)!=<span class="string">'Yes'</span>,<span class="string">"__add_mobile_1__"</span>);
                </div>
            </div>
        </div>

        <!-- Output JSON Schema -->
        <div class="section">
            <h2>Output JSON Schema</h2>

            <div class="code-block">
{
  <span class="string">"document_name"</span>: <span class="string">"Vendor Creation Sample BUD"</span>,
  <span class="string">"total_fields"</span>: <span class="variable">388</span>,
  <span class="string">"fields_with_rules"</span>: <span class="variable">245</span>,
  <span class="string">"total_rules_extracted"</span>: <span class="variable">412</span>,
  <span class="string">"extraction_stats"</span>: {
    <span class="string">"expression_rules"</span>: <span class="variable">380</span>,
    <span class="string">"standard_rules"</span>: <span class="variable">32</span>,
    <span class="string">"cache_hits"</span>: <span class="variable">156</span>,
    <span class="string">"llm_calls"</span>: <span class="variable">89</span>
  },
  <span class="string">"fields"</span>: [
    {
      <span class="string">"field_name"</span>: <span class="string">"Additional Mobile Number 1"</span>,
      <span class="string">"variable_name"</span>: <span class="string">"__add_mobile_1__"</span>,
      <span class="string">"field_type"</span>: <span class="string">"MOBILE"</span>,
      <span class="string">"original_logic"</span>: <span class="string">"Make visible and Mandatory if..."</span>,
      <span class="string">"rules"</span>: [
        {
          <span class="string">"rule_type"</span>: <span class="string">"EXPRESSION"</span>,
          <span class="string">"action"</span>: <span class="string">"EXECUTE"</span>,
          <span class="string">"expression"</span>: <span class="string">"mvi(vo(\"__add_mobile_india__\")=='Yes',\"__add_mobile_1__\");"</span>,
          <span class="string">"confidence"</span>: <span class="variable">0.95</span>,
          <span class="string">"source_field"</span>: <span class="string">"Do you wish to add additional mobile numbers (India)?"</span>,
          <span class="string">"destination_fields"</span>: [<span class="string">"Additional Mobile Number 1"</span>]
        }
      ]
    }
  ]
}
            </div>
        </div>

        <!-- Implementation Modules -->
        <div class="section">
            <h2>Implementation Modules</h2>

            <div class="pipeline" style="grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));">
                <div class="pipeline-stage">
                    <h3 style="color: #22c55e;">field_registry.py</h3>
                    <ul>
                        <li>Build display name ‚Üí variable name mapping</li>
                        <li>Normalize field names (lowercase, trim)</li>
                        <li>Fuzzy matching for field references</li>
                        <li>Generate variable names if missing</li>
                    </ul>
                </div>

                <div class="pipeline-stage">
                    <h3 style="color: #3b82f6;">rule_classifier.py</h3>
                    <ul>
                        <li>Pattern-based rule type detection</li>
                        <li>Keyword matching for visibility/mandatory</li>
                        <li>Standard rule identification</li>
                        <li>Complexity scoring for LLM routing</li>
                    </ul>
                </div>

                <div class="pipeline-stage">
                    <h3 style="color: #f59e0b;">intent_extractor.py</h3>
                    <ul>
                        <li>Pattern cache management</li>
                        <li>Grounded prompt generation</li>
                        <li>OpenAI API integration (gpt-4o-mini)</li>
                        <li>Batch processing for efficiency</li>
                    </ul>
                </div>

                <div class="pipeline-stage">
                    <h3 style="color: #ef4444;">rule_resolver.py</h3>
                    <ul>
                        <li>Display name ‚Üí variable name resolution</li>
                        <li>Standard rule schema matching</li>
                        <li>Condition expression building</li>
                        <li>Destination field mapping</li>
                    </ul>
                </div>

                <div class="pipeline-stage">
                    <h3 style="color: #a855f7;">expression_assembler.py</h3>
                    <ul>
                        <li>Function whitelist validation</li>
                        <li>expr-eval syntax generation</li>
                        <li>Multi-statement composition</li>
                        <li>Final JSON output formatting</li>
                    </ul>
                </div>

                <div class="pipeline-stage">
                    <h3 style="color: #00d4ff;">rules_orchestrator.py</h3>
                    <ul>
                        <li>End-to-end pipeline coordination</li>
                        <li>Parallel processing management</li>
                        <li>Error handling and fallbacks</li>
                        <li>Progress tracking and logging</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div style="text-align: center; padding: 40px 0; color: #666;">
            <p>Document Parser - Rules Extraction Architecture v2.0</p>
            <p style="font-size: 0.85em; margin-top: 5px;">Designed for efficiency, accuracy, and cost-effectiveness</p>
        </div>
    </div>
</body>
</html>
